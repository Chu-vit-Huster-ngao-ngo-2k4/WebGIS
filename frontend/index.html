<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebGIS Pro</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css?v=11">
</head>
<body>
  <div id="app">
    <!-- Map Container -->
    <div id="map"></div>

    <!-- Google My Maps Style Sidebar (Left) -->
    <div id="sidebar" class="sidebar google-style-sidebar">
      
      <!-- VIEW 1: Main Info & Layers -->
      <div id="sidebar-main-view">
        <!-- Sidebar Header (Red Theme) -->
        <div class="sidebar-header-red">
          <div class="header-top">
            <h2>Bản đồ trạm sạc VinFast</h2>
            <div class="header-actions">
              <button class="action-btn" id="open-search-btn" title="Tìm kiếm"><i class="fas fa-search"></i></button>
              <button class="action-btn" id="refresh-data-btn" title="Cập nhật"><i class="fas fa-sync-alt"></i></button>
            </div>
          </div>
          <p class="map-description">Bản đồ hiển thị vị trí và trạng thái các trạm sạc VinFast trên toàn quốc.</p>
          
          <div class="header-stat">
               <i class="fas fa-eye"></i> <span id="view-count">153,756 views</span>
               <span class="dot">·</span> 
               <span id="last-updated">Cập nhật hôm nay</span>
          </div>
        </div>
        
          <!-- ADDED: Color Mode Selection -->
          <div style="padding: 10px 20px; border-bottom: 1px solid #f0f0f0;">
             <div class="section-title-simple">Chế độ hiển thị màu</div>
             <div style="display: flex; gap: 15px;">
                 <label class="radio-item">
                     <input type="radio" name="style-mode" id="mode-status" checked> 
                     <span>Theo trạng thái</span>
                 </label>
                 <label class="radio-item">
                     <input type="radio" name="style-mode" id="mode-type"> 
                     <span>Theo loại xe</span>
                 </label>
             </div>
             <div style="margin-top: 10px;">
                 <label class="radio-item">
                    <input type="checkbox" id="toggle-cluster" checked>
                    <span>Gom nhóm điểm (Clustering)</span>
                 </label>
             </div>
          </div>

          <!-- ADDED: Layer Toggle Section -->
          <div style="padding: 10px 20px; border-bottom: 1px solid #f0f0f0;">
             <div class="section-title-simple">Quản lý lớp bản đồ</div>
             <div style="display: flex; flex-direction: column; gap: 8px;">
                 <label class="radio-item">
                     <input type="checkbox" id="toggle-stations" checked> 
                     <span>Trạm sạc VinFast</span>
                 </label>
                 <label class="radio-item">
                     <input type="checkbox" id="toggle-districts" checked> 
                     <span>Ranh giới Hành chính (Hà Nội)</span>
                 </label>
             </div>
          </div>
          
          <div class="sidebar-content google-style-content">
          <!-- Legend / Layer List -->
          <div class="layer-section">
               <!-- Base Map Toggle -->
               <div style="padding: 10px 20px; border-bottom: 1px solid #f0f0f0;">
                 <label class="radio-item" style="margin-bottom:5px">
                    <input type="radio" name="basemap" id="radio-osm" checked> 
                    <span style="font-weight:500;">Bản đồ Tiêu chuẩn (OSM)</span>
                 </label>
                 <label class="radio-item" style="margin-bottom:5px">
                    <input type="radio" name="basemap" id="radio-satellite"> 
                    <span style="font-weight:500;">Bản đồ Vệ tinh (ESRI)</span>
                 </label>
                 <label class="radio-item">
                    <input type="radio" name="basemap" id="radio-carto"> 
                    <span style="font-weight:500;">Bản đồ Phân tích (Tối giản)</span>
                 </label>
               </div>

               <div class="section-title">
                   <input type="checkbox" id="check-all" checked>
                   <span>Tất cả các trạm</span>
               </div>
               
               <div class="layer-list-google">
                   <!-- Layer Items -->
                   <label class="layer-item-google">
                       <span class="icon-google" style="background-color: #2980b9;"><i class="fas fa-car"></i></span>
                       <div class="layer-info">
                           <span class="layer-name">Sạc ô tô</span>
                       </div>
                       <!-- Filters are currently only active/inactive logic, so these are just legend items for now -->
                   </label>

                   <label class="layer-item-google">
                       <span class="icon-google" style="background-color: #e67e22;"><i class="fas fa-motorcycle"></i></span>
                       <div class="layer-info">
                           <span class="layer-name">Sạc xe máy</span>
                       </div>
                   </label>

                   <label class="layer-item-google">
                       <span class="icon-google" style="background-color: #16a085;"><i class="fas fa-charging-station"></i></span>
                       <div class="layer-info">
                           <span class="layer-name">Trạm hỗn hợp</span>
                       </div>
                   </label>
                   
                   <label class="layer-item-google">
                       <span class="icon-google" style="background-color: #95a5a6;"><i class="fas fa-tools"></i></span>
                       <div class="layer-info">
                           <span class="layer-name">Bảo trì / Ngưng hoạt động</span>
                       </div>
                       <input type="checkbox" class="layer-checkbox" data-filter="inactive" checked>
                   </label>
               </div>
          </div>

          <!-- ADDED: Map Tools (Fixed) -->
          <div class="control-section-minimal">
             <div class="section-title-simple">Quản lý dữ liệu</div>
             <div class="info-box" style="font-size: 12px; color:#555; margin-bottom:10px">
                <div style="margin-bottom:4px"><i class="fas fa-search-plus"></i> Zoom: <span id="zoom-level">--</span></div>
                <div><i class="fas fa-map-marker-alt"></i> Center: <span id="center-coords">--</span></div>
                <div id="feature-count" style="margin-top:5px; color:#188038; font-weight:500"></div>
             </div>
             
             <div style="margin-bottom: 10px;">
                <label class="layer-item-google" style="cursor: pointer;">
                   <input type="checkbox" id="toggle-cluster"> 
                   <span style="margin-left: 8px;">Gộp các điểm gần nhau (Cluster)</span>
                </label>
             </div>

             <button id="load-features" class="tool-btn" style="width:100%; font-size:12px"><i class="fas fa-cloud-download-alt"></i> Tải dữ liệu OSM (Current View)</button>
          </div>
        </div>
      </div>

      <!-- VIEW 2: Search Interface (Hidden by default) -->
      <div id="sidebar-search-view" style="display: none; height: 100%; flex-direction: column;">
          <div class="search-header-panel" style="background: #db4437; padding: 15px; display: flex; gap: 10px; align-items: center;">
              <button id="close-search-btn" style="background: none; border: none; color: white; cursor: pointer; font-size: 18px;"><i class="fas fa-arrow-left"></i></button>
              <div style="flex: 1; position: relative;">
                  <input type="text" id="sidebar-search-input" placeholder="Tìm kiếm địa điểm..." style="width: 100%; padding: 8px 12px; border-radius: 4px; border: none; outline: none;">
                  <button id="sidebar-search-go" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); border: none; background: none; color: #666; cursor: pointer;"><i class="fas fa-search"></i></button>
              </div>
          </div>
          <div id="sidebar-search-results" class="sidebar-content" style="flex: 1; overflow-y: auto; padding: 0;">
              <!-- Results go here -->
              <div style="padding: 20px; text-align: center; color: #888; font-style: italic;">Nhập từ khóa để tìm kiếm...</div>
          </div>
      </div>


    <!-- Right Sidebar for District Info -->
    <div id="sidebar-right" class="sidebar-right" style="display: none;">
      <div id="sidebar-district-view" style="display: flex; height: 100%; flex-direction: column;">
          <div class="district-header-panel" style="background: #db4437; padding: 15px; display: flex; gap: 10px; align-items: center; color: white;">
              <button id="close-district-btn" style="background: none; border: none; color: white; cursor: pointer; font-size: 18px;"><i class="fas fa-times"></i></button>
              <h2 style="margin: 0; font-size: 18px; font-weight: 500;">Thông tin khu vực</h2>
          </div>
          <div id="district-info-content" class="sidebar-content" style="flex: 1; overflow-y: auto; padding-left: 15px;">
              <!-- District Info goes here -->
          </div>
      </div>
    </div>

    </div>

    <!-- Hidden Controls for Logic Compatibility -->
    <div style="display:none">
       <!-- ... -->
        <input type="checkbox" id="osm-layer" checked>
        <input type="checkbox" id="charging-stations-layer" checked>
        <button id="refresh-stations-btn"></button>
        <input type="text" id="search-input">
        <button id="search-btn"></button>
    </div>

    <!-- Attribution styling handled in CSS -->
    <div id="popup" class="ol-popup">
      <a href="#" id="popup-closer" class="ol-popup-closer" title="Close"><i class="fas fa-times"></i></a>
      <div id="popup-content"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>
  <script src="js/app.js?v=debug_props_v4"></script>
</body>
</html>
